<!-- R1 -->
<div class="row">

  <!-- R1C1 -->
  <div class="col-md-6 col-xs-12">

    <span style="display: block;">
      <uib-pagination items-per-page="pageSize" max-size="5"
        boundary-links="true" class="pagination-sm" previous-text="&lsaquo;"
        next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"
        ng-show="translations.totalCount > pageSize || paging['translation'].filter"
        total-items="translations.totalCount"
        ng-model="paging['translation'].page" ng-change="getTranslations()"></uib-pagination>

      <input class="input-filter" placeholder="Enter filter text"
        ng-show="translations.totalCount > pageSize || paging['translation'].filter"
        type="text" ng-model="paging['translation'].filter"
        ng-model-options="{ debounce: 300 }" ng-change="getTranslations()">

      <button class="btn btn-xs btn-warning"
        ng-show="paging['translation'].filter"
        ng-click="paging['translation'].filter = ''; getTranslations()"
        title="Click to clear filter text">Clear</button>
      <h4 ng-show="value=='EDITING' && translations.totalCount == 0">
        <div style="float: right;">
          <i ng-click="openAddTranslationModal(); $event.stopPropagation()"
            title="Add translation" class="noul material-icons md-24">add</i>
        </div>
      </h4>
    </span>

    <span ng-show="translations.totalCount == 0" style="display: block;"
      class="alert alert-warning">No translations.</span>
    <table ng-show="translations.totalCount > 0" class="table">
      <thead>
        <th class="col-md-2 col-xs-2"
          ng-click="setSortField('translation','terminologyId', null)">Refset
          Id<span ng-bind="getSortIndicator('translation','terminologyId')"></span>
        </th>
        <th class="col-md-4 col-xs-4"
          ng-click="setSortField('translation','name', null)">Name<span
            ng-bind="getSortIndicator('translation','name',null)"></span></th>
        <th class="col-md-3 col-xs-3"
          ng-click="setSortField('translation','module', null)">Module<span
            ng-bind="getSortIndicator('translation','module',null)"></span></th>
        <th class="col-md-1 col-xs-1"
          ng-click="setSortField('translation','language', null)">Lang<span
            ng-bind="getSortIndicator('translation','language',null)"></span></th>
        <th class="col-md-2 col-xs-2"
          ng-show="value == 'EDITING' || value == 'EDITING_ALL' || value == 'RELEASE'">Actions
          <span style="float: right;">
            <i ng-click="openAddTranslationModal(); $event.stopPropagation()"
              title="Add translation" class="noul material-icons md-18">add</i>
          </span>
        </th>
      </thead>
      <tbody>
        <tr ng-repeat="translation in translations"
          ng-class="{selected: translation.id == selected.translation.id}"
          ng-click="selectTranslation(translation);" class="table-select-row">
          <td style="word-break: break-word;">{{translation.terminologyId}}</td>
          <td>
            {{translation.name}}
            <span ng-show="translation.effectiveTime">
              <br />{{toShortDate(translation.effectiveTime)}}
            </span>
          </td>
          <td>
            {{translation.moduleId}}
            <!-- Mobile friendly line-break -->
            <br class="visible-xs-inline" />
            <span flag-icon obj="translation"></span>
            <!-- Mobile friendly line-break -->
            <br class="visible-xs-inline" /> {{translation.organization}} <br />
            {{translation.workflowStatus}}
          </td>
          <td>{{translation.language}}</td>

          <!-- EDITING actions -->
          <td class="nobreak" ng-show="value == 'EDITING'">
            <i
              ng-click="openEditTranslationModal(translation); $event.stopPropagation()"
              title="Edit" class="noul material-icons md-18">edit</i>
            <i ng-click="removeTranslation(translation);" title="Remove"
              class="noul material-icons md-18">delete</i>

            <!-- Mark ready for publication -->
            <i
              ng-show="!translation.inPublicationProcess && translation.workflowStatus != 'PUBLISHED' && translation.workflowStatus!='PREVIEW'"
              ng-click="openReleaseProcessModal(translation); $event.stopPropagation()"
              title="Start release process - TODO"
              class="noul material-icons md-18">open_in_new</i>

          </td>

          <!-- EDITING_ALL actions -->
          <td class="nobreak" ng-show="value == 'EDITING_ALL'">
            <i
              ng-click="openEditTranslationModal(translation); $event.stopPropagation()"
              title="Edit" class="noul material-icons md-18">edit</i>
            <i ng-click="removeTranslation(translation);" title="Remove"
              class="noul material-icons md-18">delete</i>
          </td>
          </td>

          <!-- RELEASE actions -->
          <td class="nobreak" ng-show="value == 'RELEASE'">
            <i ng-click="removeTranslation(translation);" title="Remove"
              class="noul material-icons md-18">delete</i>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- End R1C1 -->
  </div>

  <!-- R1C2 -->
  <div class="col-md-6 col-xs-12">

    <!-- Translations list, Details panel -->
    <span ng-show="!selected.translation && translations.length > 0"
      class="alert alert-warning">Select a translation to see details</span>

    <div class="col-md-12 col-xs-12" ng-show="selected.translation">

      <!-- Translation Details -->
      <h4>{{selected.translation.name}}</h4>
      <table class="table">
        <thead class="table-select-row">
          <th class="col-md-4 col-xs-4"></th>
          <th class="col-md-8 col-xs-8"></th>
        </thead>
        <tbody>
          <tr>
            <td>
              <b>Description</b>
            </td>
            <td>{{selected.translation.description}}</td>
          </tr>
          <tr ng-show="value != 'PUBLISHED' && value != 'PREVIEW'">
            <td>
              <b>Notes</b>
            </td>
            <td>
              <div ng-show="selected.translation.notes.length > 0"
                class="truncate">
                <span ng-bind-html="getLatestNote(selected.translation)"></span>
                <span ng-show="selected.translation.notes.length > 1">
                  <br />{{selected.translation.notes.length-1}} more...
                </span>
              </div>
              <div>
                <i ng-show="selected.translation.notes.length > 0"
                  ng-click="openNotesModal(selected.translation, 'Translation'); $event.stopPropagation()"
                  title="Edit translation notes - TODO"
                  class="noul material-icons md-18">assignment</i>
                <i ng-show="selected.translation.notes == 0"
                  title="Add translation note - TODO"
                  ng-click="openNotesModal(selected.translation, 'Translation'); $event.stopPropagation()"
                  class="md-grey material-icons md-18">assignment</i>
              </div>
            </td>
          </tr>
          <tr>
            <td>Refset Id</td>
            <td>{{selected.translation.terminologyId}}</td>
          </tr>
          <tr>
            <td>Module Id</td>
            <td>
              {{selected.translation.moduleId}}
              <span flag-icon obj="selected.translation"></span>
            </td>
          </tr>
          <tr ng-show="selected.translation.effectiveTime">
            <td>Effective Time</td>
            <td>{{toShortDate(selected.translation.effectiveTime)}}</td>
          </tr>
          <tr>
            <td>Language</td>
            <td>{{selected.translation.language}}</td>
          </tr>
          <tr>
            <td>Terminology</td>
            <td>{{selected.translation.terminology}}</td>
          </tr>
          <tr>
            <td>Version</td>
            <td>{{selected.translation.version}}</td>
          </tr>
          <tr ng-show="translationReleaseInfo">
            <td>RELEASED</td>
            <td>{{translationReleaseInfo.name}}
          </tr>
          <tr ng-show="!translationReleaseInfo">
            <td>Not yet released</td>
            <td>&nbsp;</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- release info -->
    <div class="col-md-12 col-xs-12">
      <span
        ng-show="translationReleaseInfo && !translationReleaseInfo.artifacts"
        class="alert alert-warning">Release has no associated artifacts</span>
      <div class="col-md-12 col-xs-12">
        <table
          ng-show="translationReleaseInfo && translationReleaseInfo.artifacts"
          class="table">
          <thead>
            <th class="col-md-6 col-xs-6">Release File</th>
            <th class="col-md-6 col-xs-6">Timestamp</th>
            <th style="width: 1%; word-wrap: nowrap"></th>
          </thead>
          <tbody>
            <tr
              ng-repeat="artifact in translationReleaseInfo.artifacts | orderBy:'artifact.name'">
              <td>{{artifact.name}}</td>
              <td>{{toShortDate(artifact.timestamp)}}</td>
              <td>
                <i ng-click="exportReleaseArtifact(artifact)"
                  title="Export {{artifact.name}}"
                  class="noul material-icons md-18">file_download</i>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- End R1C2 -->
  </div>


  <!-- R1-->
</div>

<hr ng-show="selected.translation && value == 'EDITING'"
  style="width: 100%; color: lightgrey; height: 1px; background-color: lightgrey;" />

<!-- R2 (for "preview/published") -->
<div ng-show="value == 'EDITING'" class="row">
  <!-- R2C1 -->
  <div class="col-md-6 col-xs-12">
    <!-- Available Concepts -->
    <div class="col-md-12 col-xs-12"></div>
    <h4 ng-show="selected.translation">
      Available Concepts
      <span ng-show="selected.translation.available.totalCount>0">
        ({{selected.translation.available.totalCount}})</span>
    </h4>
    <span style="display: block;">
      <uib-pagination items-per-page="pageSize" max-size="5"
        boundary-links="true" class="pagination-sm" previous-text="&lsaquo;"
        next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"
        ng-show="selected.translation.available.totalCount > pageSize || paging['available'].filter"
        total-items="selected.translation.available.totalCount"
        ng-model="paging['available'].page"
        ng-change="getAvailableConcepts(selected.translation)"></uib-pagination>

      <input class="input-filter" placeholder="Enter filter text"
        ng-show="selected.translation.available.totalCount > pageSize || paging['available'].filter"
        type="text" ng-model="paging['available'].filter"
        ng-model-options="{ debounce: 300 }"
        ng-change="getAvailableConcepts(selected.translation)">

      <button class="btn btn-xs btn-warning"
        ng-show="paging['available'].filter"
        ng-click="paging['available'].filter = ''; getAvailableConcepts(selected.translation)"
        title="Click to clear filter text">Clear</button>
    </span>

    <span ng-show="selected.translation.available.totalCount == 0"
      style="display: block;" class="alert alert-warning">No available
      concepts.</span>
    <table ng-show="selected.translation.available.totalCount > 0" class="table">
      <thead>
        <th class="col-md-3 col-xs-3"
          ng-click="setSortField('available','terminologyId', null)">Concept
          Id<span ng-bind="getSortIndicator('available','terminologyId')"></span>
        </th>
        <th class="col-md-5 col-xs-5"
          ng-click="setSortField('available','name', null)">Name<span
            ng-bind="getSortIndicator('available','name',null)"></span></th>
        <th class="col-md-2 col-xs-2"
          ng-click="setSortField('available','lastModified', selected.translation)">Last
          Modified<span ng-bind="getSortIndicator('available','lastModified')"></span>
        </th>
        <th class="col-md-2 col-xs-2">Actions <!-- Assign --> <i
            ng-show="projects.role != 'ADMIN' && selected.translation.available.totalCount > 0"
            ng-click="openBatchAssignConceptModal(selected.translation, user.userName); $event.stopPropagation()"
            title="Assign batch" class="noul material-icons md-18">assignment_ind</i></th>
      </thead>
      <tbody>
        <tr ng-repeat="concept in selected.translation.available">
          <td style="word-break: break-word;">{{concept.terminologyId}}</td>
          <td>{{concept.name}}</td>
          <td>{{toDate(concept.lastModified)}}</td>
          <!-- Actions -->
          <td class="nobreak">
            <!-- Assign -->
            <i ng-show="projects.role != 'ADMIN'"
              ng-click="openAssignConceptModal(selected.translation, concept, user.userName); $event.stopPropagation()"
              title="Assign" class="noul material-icons md-18">assignment_ind</i>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- End R2C1 -->
  </div>

  <!-- R2C2 -->
  <div class="col-md-6 col-xs-12">
    <!-- Assigned Concepts-->
    <div class="col-md-12 col-xs-12"></div>

    <h4 ng-show="selected.translation">
      Assigned Concepts
      <span ng-show="selected.translation.assigned.totalCount>0">
        ({{selected.translation.assigned.totalCount}})</span>
    </h4>
    <span style="display: block;">
      <uib-pagination items-per-page="pageSize" max-size="5"
        boundary-links="true" class="pagination-sm" previous-text="&lsaquo;"
        next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"
        ng-show="selected.translation.assigned.totalCount > pageSize || paging['assigned'].filter"
        total-items="selected.translation.assigned.totalCount"
        ng-model="paging['assigned'].page"
        ng-change="getAssignedConcepts(selected.translation)"></uib-pagination>

      <input class="input-filter" placeholder="Enter filter text"
        ng-show="selected.translation.assigned.totalCount > pageSize || paging['assigned'].filter"
        type="text" ng-model="paging['assigned'].filter"
        ng-model-options="{ debounce: 300 }"
        ng-change="getAssignedConcepts(selected.translation)">

      <button class="btn btn-xs btn-warning" ng-show="paging['assigned'].filter"
        ng-click="paging['assigned'].filter = ''; getAssignedConcepts(selected.translation)"
        title="Click to clear filter text">Clear</button>
    </span>

    <span ng-show="selected.translation.assigned.totalCount == 0"
      style="display: block;" class="alert alert-warning">No assigned
      concepts.</span>
    <table ng-show="selected.translation.assigned.totalCount > 0" class="table">
      <thead>
        <th class="col-md-3 col-xs-3"
          ng-click="setSortField('assigned','conceptTerminologyId', null)">Concept
          Id<span ng-bind="getSortIndicator('assigned','conceptTerminologyId')"></span>
        </th>
        <th class="col-md-5 col-xs-5"
          ng-click="setSortField('assigned','conceptName', null)">Name<span
            ng-bind="getSortIndicator('assigned','conceptName',null)"></span></th>
        <th class="col-md-2 col-xs-2"
          ng-click="setSortField('assigned','lastModified', selected.translation)">Last
          Modified<span ng-bind="getSortIndicator('assigned','lastModified')"></span>
        </th>
        <th class="col-md-2 col-xs-2">Actions <i
            ng-show="selected.translation.assigned.totalCount > 0"
            ng-click="unassignAll();" title="Unassign all"
            class="noul material-icons md-18">assignment_return</i></th>
      </thead>
      <tbody>
        <tr ng-repeat="record in selected.translation.assigned">
          <td style="word-break: break-word;">{{record.concept.terminologyId}}</td>
          <td>{{record.concept.name}}</td>
          <td>
            {{toDate(record.concept.lastModified)}}<br />{{record.concept.workflowStatus}}
          </td>
          <!-- Actions -->
          <td class="nobreak">
            <!-- Edit -->
            <i
              ng-click="openEditConceptModal(record.concept); $event.stopPropagation()"
              title="Edit concept" class="noul material-icons md-18">edit</i>

            <!-- UnAssign (instead of delete) -->
            <i ng-show="projects.role != 'ADMIN'"
              ng-click="unassign(record.concept)" title="Unassign"
              class="noul material-icons md-18">assignment_return</i>

            <span ng-show="projects.role == 'ADMIN'">
              <span ng-repeat="author in record.authors">
                <!-- Only unassign if there are no reviewers -->
                <i ng-show="!record.reviewers || record.reviewers.length == 0"
                  uib-tooltip="Unassign author: {{author.userName}}"
                  ng-click="unassign(record.concept)"
                  class="noul material-icons md-18">assignment_return</i>
                <i ng-show="record.reviewers.length > 0"
                  uib-tooltip="Author: {{author.userName}}, unassign reviewer first"
                  class="md-grey material-icons md-18">assignment_ind</i>
              </span>
              <span ng-repeat="reviewer in record.reviewers">
                <i uib-tooltip="Unassign reviewer: {{reviewer.userName}}"
                  ng-click="unassign(record.concept)"
                  class="noul material-icons md-18">assignment_return</i>
              </span>
            </span>


            <!-- Reassign - if REVIEW -->
            <i ng-show="record.concept.workflowStatus != 'REVIEW_DONE'"
              ng-click="performWorkflowAction(record.concept, 'FINISH');"
              title="Finish" class="noul material-icons md-18">done</i>

          </td>
        </tr>
      </tbody>
    </table>


    <!-- End R2C2 -->
  </div>

  <!-- End R2 -->
</div>

<hr ng-show="selected.translation"
  style="width: 100%; color: lightgrey; height: 1px; background-color: lightgrey;" />

<!-- R3 - concept list and details panel -->
<div class="row">

  <!-- R3C1 -->
  <div class="col-md-6 col-xs-12">

    <div class="col-md-12 col-xs-12" ng-show="selected.concept">
      <!-- Selected Concept Detail -->
      <span
        ng-show="!selected.concept && selected.translation.concepts.length > 0"
        class="alert alert-warning">Select a concept to see details</span>
      <div concept-info data="selected"></div>
    </div>
    <!-- End R3C1 -->
  </div>

  <!-- R3C2 -->
  <div class="col-md-6 col-xs-12">

    <!-- Translation Concepts -->
    <div class="col-md-12 col-xs-12">

      <h4 ng-show="selected.translation">
        Translation Concepts
        <span ng-show="selected.translation.concepts.totalCount>0">
          ({{selected.translation.concepts.totalCount}})</span>
      </h4>

      <span
        ng-show="selected.translation && !paging['concept'].filter && selected.translation.concepts.totalCount == 0">
        <br />
        <span class="alert alert-warning">Translation has no concepts </span>
      </span>

      <span
        ng-show="selected.translation.concepts.totalCount > 0 || paging['concept'].filter">

        <span style="display: block;">
          <uib-pagination items-per-page="pageSize" max-size="5"
            boundary-links="true" class="pagination-sm" previous-text="&lsaquo;"
            next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"
            ng-show="selected.translation.concepts.totalCount > pageSize || paging['concept'].filter"
            total-items="selected.translation.concepts.totalCount"
            ng-model="paging['concept'].page"
            ng-change="getConcepts(selected.translation)"></uib-pagination>

          <input class="input-filter" placeholder="Enter filter text"
            ng-show="selected.translation.concepts.totalCount > pageSize || paging['concept'].filter"
            type="text" ng-model="paging['concept'].filter"
            ng-model-options="{ debounce: 300 }"
            ng-change="getConcepts(selected.translation)">

          <button class="btn btn-xs btn-warning"
            ng-show="paging['concept'].filter"
            ng-click="paging['concept'].filter = ''; getConcepts(selected.translation)"
            title="Click to clear filter text">Clear</button>
        </span>

        <table class="table">
          <thead>
            <th class="col-md-3 col-xs-3"
              ng-click="setSortField('concept','terminologyId', selected.translation)">Concept
              Id<span ng-bind="getSortIndicator('concept','terminologyId')"></span>
            </th>
            <th class="col-md-5 col-xs-5"
              ng-click="setSortField('concept','name', selected.translation)">Name<span
                ng-bind="getSortIndicator('concept','name')"></span>
            </th>
            <th ng-show="value != 'PUBLISHED' && value != 'PREVIEW'"
              class="col-md-2 col-xs-2"
              ng-click="setSortField('concept','lastModified', selected.translation)">Last
              Modified<span ng-bind="getSortIndicator('concept','lastModified')"></span>
            </th>
            <th ng-show="value == 'PUBLISHED' || value == 'PREVIEW'"
              class="col-md-2 col-xs-2"
              ng-click="setSortField('concept','effectiveTime', selected.translation)">Effective
              Time<span ng-bind="getSortIndicator('concept','effectiveTime')"></span>
            </th>
            <th ng-show="value == 'ASSIGNED' ">Actions</th>
          </thead>
          <tbody>
            <tr ng-repeat="concept in selected.translation.concepts"
              ng-class="{selected: concept.id == selected.concept.id}"
              ng-click="selectConcept(concept);">
              <td>{{concept.terminologyId}}</td>
              <td>
                {{concept.name}}
                <span
                  ng-repeat="desc in concept.descriptions | orderBy:'desc.term'">
                  <br /> &bull;&nbsp;{{desc.term}}
                </span>
              </td>
              <td ng-show="value != 'PUBLISHED' && value != 'PREVIEW'">{{toDate(concept.lastModified)}}</td>
              <td ng-show="value == 'PUBLISHED' || value == 'PREVIEW'">{{toShortDate(concept.effectiveTime)}}</td>
              <td>
                <!-- Assign (for error fixing) -->
                <i ng-show="value == 'EDITING' && projects.role != 'ADMIN'"
                  ng-click="openAssignConceptModal(selected.translation, concept, user.userName); $event.stopPropagation()"
                  title="Assign" class="noul material-icons md-18">assignment_ind</i>

                <!-- Notes -->
                <i ng-show="concept.notes.length > 0"
                  title="Edit concept Notes - todo"
                  class="noul material-icons md-18">assignment</i>
                <i ng-show="concept.notes.length == 0"
                  title="Add Concept Notes - todo"
                  class="md-grey material-icons md-18">assignment</i>
              </td>
            </tr>
          </tbody>
        </table>
        <span
          ng-show="paging['concept'].filter && selected.translation.concepts.totalCount == 0"
          class="alert alert-warning">
          <br />No translation concepts matching filter
        </span>

      </span>
    </div>

    <!-- EndR3C2 -->
  </div>

  <!-- End R3 -->
</div>

