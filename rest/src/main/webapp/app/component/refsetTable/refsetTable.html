
<div class="row">

  <div class="col-md-6 col-xs-12">

    <span style="display: block;">
      <pagination items-per-page="pageSize" max-size="5" boundary-links="true"
        class="pagination-sm" previous-text="&lsaquo;" next-text="&rsaquo;"
        first-text="&laquo;" last-text="&raquo;"
        ng-show="refsets.totalCount > pageSize || paging['refset'].filter"
        total-items="refsets.totalCount" ng-model="paging['refset'].page"
        ng-change="getRefsets()"></pagination>

      <input class="input-filter" placeholder="Enter filter text"
        ng-show="refsets.totalCount > pageSize || paging['refset'].filter"
        type="text" ng-model="paging['refset'].filter"
        ng-model-options="{ debounce: 300 }" ng-change="getRefsets()">

      <button class="btn btn-xs btn-warning" ng-show="paging['refset'].filter"
        ng-click="paging['refset'].filter = ''; getRefsets()"
        title="Click to clear filter text">Clear</button>

      <h4 ng-show="value == 'AVAILABLE'">
        <div style="float: right;">
          <a title="Create new refset" ng-click="openNewRefsetModal(lrefset)">
            <i title="Create new refset" class="material-icons md-24">add</i>
          </a>
        </div>
      </h4>
    </span>


    <!-- Basic Refset info -->
    <span ng-show="refsets.totalCount == 0" style="display: block;"
      class="alert alert-warning">No {{value}} refsets.</span>
    <table ng-show="refsets.totalCount > 0" class="table">
      <thead>
        <th class="col-md-2 col-xs-2"
          ng-click="setSortField('refset','terminologyId', null)">Refset Id<span
            ng-bind="getSortIndicator('refset','terminologyId')"></span>
        </th>
        <th class="col-md-5 col-xs-5"
          ng-click="setSortField('refset','name', null)">Name<span
            ng-bind="getSortIndicator('refset','name',null)"></span></th>
        <th class="col-md-3 col-xs-3"
          ng-click="setSortField('refset','moduleId', null)">Module<span
            ng-bind="getSortIndicator('refset','moduleId',null)"></span></th>
        <th class="col-md-1 col-xs-1"
          ng-click="setSortField('refset','type', null)">Type<span
            ng-bind="getSortIndicator('refset','type',null)"></span></th>
        <th class="col-md-1 col-xs-1"
          ng-show="value == 'AVAILABLE' || value == 'ASSIGNED' || value == 'ASSIGNED_ALL' || value == 'RELEASE'"
          ng-click="setSortField('refset','type', null)">Actions<span
            ng-bind="getSortIndicator('refset','type',null)"></span></th>
      </thead>
      <tbody>
        <tr ng-repeat="refset in refsets" ng-click="selectRefset(refset);"
          class="table-select-row">
          <td style="word-break: break-word;">{{refset.terminologyId}}</td>
          <td>{{refset.name}}</td>
          <td>{{refset.moduleId}}<!-- Mobile friendly line-break --> <br
            class="visible-xs-inline" /> <img
            ng-show="iconConfig[refset.moduleId]" title="Flag icon"
            src="{{iconConfig[refset.moduleId]}}" /> <!-- Mobile friendly line-break -->
            <br class="visible-xs-inline" /> {{refset.organization}}
            <span ng-show="value == 'AVAILABLE' || value == 'ASSIGNED' || value == 'ASSIGNED_ALL' || value == 'RELEASE'">
              <br> {{refset.workflowStatus}}</span>
          </td>
          <td><a ng-show="refset.type == 'EXTERNAL'" ng-click=""
              style="text-decoration: none">
              <i tooltip="Reference to an external refset stored elsewhere."
                class="material-icons md-18">forward</i>
            </a> <a ng-show="refset.type == 'EXTENSIONAL'" ng-click=""
              style="text-decoration: none">
              <i ng-show="refset.type == 'EXTENSIONAL'"
                tooltip="Extensional refset, defined as an explicit list of members."
                class="material-icons md-18">list</i>
            </a> <a ng-show="refset.type == 'INTENSIONAL'" ng-click=""
              style="text-decoration: none">
              <i ng-show="refset.type == 'INTENSIONAL'"
                tooltip="Intenional refset, defined as a definition with includes/excludes."
                class="material-icons md-18">functions</i>
            </a></td>
            <td class="nobreak"
               ng-show="value == 'AVAILABLE'"><a title="Edit"
                ng-click="openEditRefsetModal(refset); $event.stopPropagation()">
                <i title="Edit" class="material-icons md-18">edit</i>
              </a>&nbsp;<a title="Remove"
                ng-click="remove('refset',refset,refsets); $event.stopPropagation()">
                <i title="Delete" class="material-icons md-18">delete</i>
              </a>&nbsp;<a title="Assign"
                ng-click="openChooseUserModal(refset, 'ASSIGN', user.userName); $event.stopPropagation()">
                <i title="Assign" class="material-icons md-18">assignment</i>
              </a>&nbsp;<a title="Clone"
                ng-click="openCloneRefsetModal(refset); $event.stopPropagation()">
                <i title="Clone" class="material-icons md-18">content_copy</i>
              </a></td>
           <td class="nobreak" ng-show="value == 'ASSIGNED_ALL'"><a title="Edit"
                ng-click="openEditRefsetModal(refset); $event.stopPropagation()">
                <i title="Edit" class="material-icons md-18">edit</i>
              </a>&nbsp;<a title="Remove"
                ng-click="remove('refset',refset,refsets); $event.stopPropagation()">
                <i title="Delete" class="material-icons md-18">delete</i>
              </a>&nbsp;<a title="Assigned">
                <i title="Assigned to {{refsetIdToAuthorsMap[refset.id][0].userName}} 
                {{refsetIdToReviewersMap[refset.id][0].userName}}" class="material-icons md-18">assignment_ind</i>
              </a>&nbsp;<a title="Unassign"
                ng-click="performWorkflowAction(refset, 'UNASSIGN', user.userName); $event.stopPropagation()">
                <i title="Unassign" class="material-icons md-18">assignment_return</i>
              </a></td>
           <td class="nobreak" ng-show="value == 'ASSIGNED'"><a title="Edit"
                ng-click="openEditRefsetModal(refset); $event.stopPropagation()">
                <i title="Edit" class="material-icons md-18">edit</i>
              </a>&nbsp;<a title="Remove"
                ng-click="remove('refset',refset,refsets); $event.stopPropagation()">
                <i title="Delete" class="material-icons md-18">delete</i>
              </a>&nbsp;<a title="Unassign"
                ng-click="performWorkflowAction(refset, 'UNASSIGN', user.userName); $event.stopPropagation()">
                <i title="Unassign" class="material-icons md-18">assignment_return</i>
              </a>&nbsp;<a title="Reassign" ng-show="role == 'REVIEWER'"
                ng-click="openChooseUserModal(refset, 'REASSIGN', user.userName); $event.stopPropagation()">
                <i title="Reassign" class="material-icons md-18">assignment_returned</i>
              </a>&nbsp;<a title="Save"
                ng-click="performWorkflowAction(refset, 'SAVE', user.userName); $event.stopPropagation()">
                <i title="Save" class="material-icons md-18">save</i>
              </a>&nbsp;<a title="Finish"
                ng-click="performWorkflowAction(refset, 'FINISH', user.userName); $event.stopPropagation()">
                <i title="Finish" class="material-icons md-18">done</i>
              </a></td>
           <td class="nobreak" ng-show="value == 'RELEASE'"><a title="Remove"
                ng-click="remove('refset',refset,refsets); $event.stopPropagation()">
                <i title="Delete" class="material-icons md-18">delete</i>
              </a>&nbsp;<a title="Assign" ng-show="refset.workflowStatus == 'READY_FOR_PUBLICATION'"
                ng-click="openChooseUserModal(refset, 'ASSIGN', user.userName); $event.stopPropagation()">
                <i title="Assign" class="material-icons md-18">assignment</i>
              </a>&nbsp;<a title="Publish"
                ng-click="openReleaseProcessModal(refset, '20151112')">
                <i title="Publish" class="material-icons md-18">publish</i>
              </a></td>
        </tr>
      </tbody>
    </table>
  </div>


  <span ng-show="!refset && refsets.length > 0" class="alert alert-warning">Select a refset to
    see details</span>

  <!-- Details, Releases, Members -->
  <div ng-show="refset" class="col-md-6 col-xs-12">
    <div class="col-md-12 col-xs-12">

      <!-- Refset Details -->
      <h4>
        <div style="float: left;">{{refset.name}}</div>
        
      </h4><br>
      
      <b>Description: </b>{{refset.description}}
      <table class="table">
        <thead>
          <th>&nbsp;</th>
          <th>&nbsp;</th>
        </thead>
        <tbody>
          <tr>
            <td>Refset Id</td>
            <td>{{refset.terminologyId}}</td>
          </tr>
          <tr>
            <td>Module Id</td>
            <td>{{refset.moduleId}} <img
              ng-show="iconConfig[refset.moduleId]" title="Flag icon"
              src="{{iconConfig[refset.moduleId]}}" /></td>
          </tr>
          <tr>
            <td>Organization</td>
            <td>{{refset.organization}}</td>
          </tr>
          <tr>
            <td>Effective Time</td>
            <td>{{toShortDate(refset.effectiveTime)}}</td>
          </tr>
          <tr>
            <td>Terminology</td>
            <td>{{refset.terminology}} {{refset.version}}</td>
          </tr>
          <tr ng-show="refset.type == 'INTENSIONAL'">
            <td>Definition</td>
            <td>{{refset.definition}}<a ng-click="openImportExportModal(refset, 'Export', 'Definition')">
                    <i title="Export definition"
                      class="material-icons md-18">file_download</i>
          </a><a ng-click="openImportExportModal(refset, 'Import', 'Definition')">
                    <i title="Import definition"
                      class="material-icons md-18">file_upload</i>
          </a></td>            
          </tr>
          <tr ng-show="refset.type == 'EXTERNAL'">
            <td>External Url</td>
            <td>{{refset.externalUrl}}</td>
          </tr>
          <tr ng-show="refset.releaseInfo">
            <td>RELEASED</td>
            <td>{{refset.releaseInfo.name}}
          </tr>
          <tr ng-show="!refset.releaseInfo">
            <td>Not yet released</td>
            <td>&nbsp;</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- release info -->
    <div class="col-md-12 col-xs-12">
      <span ng-show="refset.releaseInfo && !refset.releaseInfo.artifacts"
        class="alert alert-warning">Release has no associated artifacts</span>
      <div class="col-md-12 col-xs-12">
        <table ng-show="refset.releaseInfo && refset.releaseInfo.artifacts"
          class="table">
          <thead>
            <th class="col-md-6 col-xs-6">Release File</th>
            <th class="col-md-6 col-xs-6">Timestamp</th>
            <th style="width: 1%; word-wrap: nowrap"></th>
          </thead>
          <tbody>
            <tr
              ng-repeat="artifact in refset.releaseInfo.artifacts | orderBy:'artifact.name'">
              <td>{{artifact.name}}</td>
              <td>{{toShortDate(artifact.timestamp)}}</td>
              <td><span>
                  <a ng-click="exportReleaseArtifact(artifact)">
                    <i title="Export {{artifact.name}}"
                      class="material-icons md-18">file_download</i>
                  </a>
                </span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="col-md-12 col-xs-12">
      <h4>Refset Members
      <div style="float: right;">
          <a ng-click="openImportExportModal(refset, 'Export', 'Refset Members')">
                    <i title="Export refset members"
                      class="material-icons md-18">file_download</i>
          </a>
          <a ng-click="openImportExportModal(refset, 'Import', 'Refset Members')">
                    <i title="Import refset members"
                      class="material-icons md-18">file_upload</i>
          
        </div></h4>
      <span ng-show="!refset.members" class="alert alert-warning">Refset
        has no members</span>

      <span>
        <span style="display: block;">
          <pagination items-per-page="pageSize" max-size="5"
            boundary-links="true" class="pagination-sm" previous-text="&lsaquo;"
            next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"
            ng-show="refset.members.totalCount > pageSize || paging['member'].filter"
            total-items="refset.members.totalCount"
            ng-model="paging['member'].page" ng-change="getMembers(refset)"></pagination>

          <input class="input-filter" placeholder="Enter filter text"
            ng-show="refset.members.totalCount > pageSize || paging['member'].filter"
            type="text" ng-model="paging['member'].filter"
            ng-model-options="{ debounce: 300 }" ng-change="getMembers(refset)">

          <button class="btn btn-xs btn-warning"
            ng-show="paging['member'].filter"
            ng-click="paging['member'].filter = ''; getMembers(refset)"
            title="Click to clear filter text">Clear</button>

          <h4 ng-show="value == 'ASSIGNED'">
            <div style="float: right;">
              <a title="Create new refset member"
                ng-click="openNewMemberModal(lmember, refset)">
                <i title="Create new refset member" class="material-icons md-24">add</i>
              </a>
            </div>
          </h4>
        </span>


        <table class="table">
          <thead>
            <th class="col-md-4 col-xs-4"
              ng-click="setSortField('member','conceptId', refset)">Concept
              Id<span ng-bind="getSortIndicator('member','conceptId')"></span>
            </th>
            <th class="col-md-4 col-xs-4"
              ng-click="setSortField('member','conceptName', refset)">Name<span
                ng-bind="getSortIndicator('member','conceptName')"></span>
            </th>
            <th class="col-md-4 col-xs-4"><select
              title="Filter by member type" style="width: 100px;"
              ng-model="paging['member'].typeFilter"
              ng-options="item for item in memberTypes"
              ng-change="getMembers(refset)">
                <option value="">All</option>
            </select></th>
            <th ng-show="value == 'ASSIGNED' ">Actions</th>
          </thead>
          <tbody>
            <tr ng-repeat="member in refset.members"
              ng-class="getMemberStyle(member)">
              <td ng-disabled="isDisabled(member)">{{member.conceptId}}</td>
              <td ng-disabled="isDisabled(member)">{{member.conceptName}}</td>
              <td><a ng-show="member.memberType == 'INCLUSION'" ng-click=""
                  style="text-decoration: none">
                  <i ng-show="member.memberType == 'INCLUSION'"
                    tooltip="Explicit inclusion, not resolved by the definition"
                    class="material-icons md-18">info</i>
                </a> <a ng-show="member.memberType == 'INACTIVE_INCLUSION'"
                  ng-click="" style="text-decoration: none">
                  <i ng-show="member.memberType == 'INACTIVE_INCLUSION'"
                    tooltip="Explicit inclusion of an inactive concept in the current edition"
                    class="material-icons md-18">info-outline</i>
                </a> <a ng-show="member.memberType == 'EXCLUSION'" ng-click=""
                  style="text-decoration: none">
                  <i ng-show="member.memberType == 'EXCLUSION'"
                    tooltip="Explicit exclusion, resolved by the definition, but overridden"
                    class="material-icons md-18">info</i>
                </a> <a ng-show="member.memberType == 'INACTIVE_MEMBER'" ng-click=""
                  style="text-decoration: none">
                  <i ng-show="member.memberType == 'INACTIVE_MEMBER'"
                    tooltip="Inactive concept in current edition"
                    class="material-icons md-18">info-outline</i>
                </a></td>
              <td class="nobreak" ng-show="value == 'ASSIGNED' || value == 'ASSIGNED_ALL'">
                <a
                  title="Remove" ng-show="refset.type == 'EXTENSIONAL' || member.memberType != 'MEMBER'"
                  ng-click="remove('member',member,refset.members); $event.stopPropagation()">
                  <i title="Remove" class="material-icons md-18">delete</i>
                </a>&nbsp;<a
                  title="Make exclusion" ng-show="refset.type == 'INTENSIONAL' && member.memberType == 'MEMBER'"
                  ng-click="exclude(refset, member.conceptId); $event.stopPropagation()">
                  <i title="Make exclusion" class="material-icons md-18">remove_circle_outline</i>
                </a></td>
            </tr>
          </tbody>
        </table>
      </span>
    </div>
  </div>
</div>